# Development .htaccess for CalFormat
# Less restrictive configuration for local development and debugging

<IfModule mod_rewrite.c>
    RewriteEngine On
</IfModule>

# ====================================================================
# DEVELOPMENT HEADERS (More permissive)
# ====================================================================
<IfModule mod_headers.c>
    # CORS Headers - More permissive for development
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE, PATCH"
    Header always set Access-Control-Allow-Headers "*"
    Header always set Access-Control-Allow-Credentials "true"
    Header always set Access-Control-Max-Age "86400"
      # Relaxed CSP for development - Fixed for API calls
    Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https: http:; connect-src 'self' https://*.myikas.com https://calformat.myikas.com https: http: ws: wss:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https: http:; img-src 'self' data: blob: https: http:; font-src 'self' data: https: http:;"
    
    # Basic Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # Development debugging headers
    Header always set X-Debug-Mode "development"
    
    # Disable caching in development
    Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header always set Pragma "no-cache"
    Header always set Expires "0"
</IfModule>

# ====================================================================
# DEVELOPMENT ROUTING
# ====================================================================
<IfModule mod_rewrite.c>
    # Enable detailed error logging
    RewriteLog logs/rewrite.log
    RewriteLogLevel 3
    
    # Handle OPTIONS requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
      # API Routes - Handle PHP files in public directory
    RewriteCond %{REQUEST_URI} ^/public/.*\.php$
    RewriteRule ^public/(.*)$ public/$1 [L]
    
    # Handle direct PHP file access
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_FILENAME} \.php$
    RewriteRule ^(.*)$ $1 [L]
    
    # Static Assets
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^(.*)$ - [L]
    
    # React Router fallback
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_URI} !\.php$
    RewriteRule ^(.*)$ /index.html [L]
</IfModule>

# ====================================================================
# DEVELOPMENT ERROR HANDLING
# ====================================================================
# Show detailed errors in development
php_flag display_errors On
php_flag display_startup_errors On
php_value error_reporting -1

# Error pages still go to React app
ErrorDocument 404 /index.html
ErrorDocument 403 /index.html
ErrorDocument 500 /index.html

# ====================================================================
# MIME TYPES
# ====================================================================
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType application/json .json
    AddType image/webp .webp
    AddType font/woff .woff
    AddType font/woff2 .woff2
</IfModule>
